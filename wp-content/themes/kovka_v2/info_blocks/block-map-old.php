<?php$block_title = trim($post_info_block_fields["infoblock_title"]);$block_padding_top = (int)$post_info_block_fields["infoblock_padding_margin"]["infoblock_padding_top"];$block_padding_bottom = (int)$post_info_block_fields["infoblock_padding_margin"]["infoblock_padding_bottom"];$block_margin_top = (int)$post_info_block_fields["infoblock_padding_margin"]["infoblock_margin_top"];$block_margin_bottom = (int)$post_info_block_fields["infoblock_padding_margin"]["infoblock_margin_bottom"];$block_background_enable = $post_info_block_fields["infoblock_background_enable"];$block_background_image = $post_info_block_fields["infoblock_background_image"];$block_background_image_mobile = $post_info_block_fields["infoblock_background_image_mobile"];$block_background_color = strtolower($post_info_block_fields["infoblock_background_color"]);$block_dark_overlay = $post_info_block_fields["infoblock_dark_overlay"];$block_white_foreground = $post_info_block_fields["infoblock_white_foreground"];$block_map = $post_info_block_fields["map_new"];$block_map_phone = $option_phone ?? '';?><!-- Contact Area End Here --><style>    #<?= $block_id; ?>-map {        width: 100%;        height: 400px;    }    #<?= $block_id; ?> {        padding-top: <?= $block_padding_top; ?>px;        padding-bottom: <?= $block_padding_bottom; ?>px;        margin-top: <?= $block_margin_top; ?>px;        margin-bottom: <?= $block_margin_bottom; ?>px;        position: relative;        <? if (($block_background_color !='') && ($block_background_color !='#ffffff')) {            ?>background-color: <?= $block_background_color; ?>;            <?        }        ?>    }    <? if ($block_background_image !='') {        ?><? if ($block_dark_overlay) {            ?>#<?= $block_id; ?>:before {                content: '';                position: absolute;                width: 100%;                height: 100%;                top: 0;                left: 0;                background: #000;                opacity: 0.7;                z-index: 1;            }            <?        }        ?>#<?= $block_id; ?>>div {            position: relative;            z-index: 5;        }        #<?= $block_id; ?>:after {            content: '';            position: absolute;            width: 100%;            height: 100%;            top: 0;            left: 0;            background-image: url(<?= $block_background_image; ?>);            background-position: center center;            background-repeat: no-repeat;            background-size: cover;            z-index: 0;        }        @media only screen and (min-width: 768px) {            #<?= $block_id; ?>:after {                background-attachment: fixed;            }        }        @media only screen and (max-width: 767px) {            #<?= $block_id; ?>:after {                <?php if ($block_background_image_mobile != "") { ?>background-image: url(<?= $block_background_image_mobile; ?>);                <?php } ?>            }        }        <?    }    ?>@media only screen and (max-width: 575.98px) {        #<?= $block_id; ?>-map {            height: 500px !important;        }    }</style><section class="map" style="min-height:23.75rem;">    <style>        .map {            padding: 40px 0;        }    </style>    <div class="container">        <div id="ID-map" class="map-block">        </div>        <div class="map__info-wrap">            <div class="map__info">                <h2><?= $block_title?></h2>                <ul>                    <?php                    if (!empty($block_map['map_elements'])):                        foreach ($block_map['map_elements'] as $element => $block_map_element_item):?>                            <li>                                <img src="<?= $block_map_element_item['map_icon']?>" alt="">                                <span><?= $block_map_element_item['map_text']?></span>                            </li>                        <?php endforeach; endif;?>                </ul>                <p><?= $block_map['text_over_map_btn']?></p>                <?php if ($block_map['cns_btns_map'] ):?>                    <?php foreach($block_map['cns_btns_map'] as $header_btns_cns_items => $header_btns_cns_item) { ?>                        <a href="<?= $header_btns_cns_item['case_btn_link_cns']?>" class="<?php                        switch ($header_btns_cns_item['case_btn_type_cns']) {                            case 'link':                                echo "link";                                break;                            case 'colored':                                echo " btn";                                break;                            case 'bordered':                                echo " btn outline-btn";                                break;                        }                        switch ($header_btns_cns_item['case_btn_color_cns']) {                            case 'red':                                echo " red-btn";                                break;                            case 'blue':                                echo " hell-blue-btn";                                break;                            case 'dark_blue':                                echo " blue-btn";                                break;                        }                        ?> ">                            <?=$header_btns_cns_item['case_btn_name_cns'];?>                        </a>                    <?php } ?>                <?php endif;?>            </div>        </div>    </div></section><script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script><!-- Contact Area Start Here --><script>    var welcomeMap;    var welcomeMarkers = [{        "map_point_lat": "<?= $block_map['map_new_shirota']; ?>",        "map_point_lng": "<?= $block_map['map_new_dolgota']; ?>",        "map_point_address": "<?= $block_map['map_new_adres']; ?>"    }];    // Дождёмся загрузки API и готовности DOM.    ymaps.ready(init);    function init() {        welcomeMap = new ymaps.Map('<?= $block_id; ?>-map', {            center: [<?= $block_map['map_new_shirota']; ?>, <?= $block_map['map_new_dolgota']; ?>], // Москва            zoom: 10,            controls: []        });        var zoomControl = new ymaps.control.ZoomControl({            options: {                size: "large",                position: {                    right: 50,                    top: 120                }            }        });        var fullscreenControl = new ymaps.control.FullscreenControl({            options: {                position: {                    right: 50,                    top: 50                }            }        });        welcomeMap.events.add('balloonopen', function(e) {            var balloon = e.get('balloon');            welcomeMap.events.add('click', function(e) {                if (e.get('target') === welcomeMap) { // Если клик был на карте, а не на геообъекте                    welcomeMap.balloon.close();                }            });        });        // Добавление контролов на карту        welcomeMap.controls.add(zoomControl);        welcomeMap.controls.add(fullscreenControl);        welcomeMap.behaviors.disable('scrollZoom');        var myCollection = new ymaps.GeoObjectCollection();        for (var i = 0; i < welcomeMarkers.length; i++) {            var marker_obj = welcomeMarkers[i];            var lat = parseFloat(marker_obj.map_point_lat);            var lon = parseFloat(marker_obj.map_point_lng);            var popupText = marker_obj.map_point_address;            var popupPhone = (marker_obj.map_point_phone) ? "<br>" + marker_obj.map_point_phone : "";            myCollection.add(                new ymaps.Placemark([lat, lon], {                    balloonContent: popupText + popupPhone                }, {                    iconLayout: 'default#image',                    iconImageHref: '<?php bloginfo('stylesheet_directory'); ?>/img/point-map.svg',                    iconImageSize: [30, 53],                    iconImageOffset: [-22, -60],                    // Балун не имеет тени                    balloonShadow: false,                }));        }        welcomeMap.geoObjects.add(myCollection);        welcomeMap.setBounds(myCollection.getBounds(), {            checkZoomRange: true        }).then(function() {            if (welcomeMap.getZoom() > 11) welcomeMap.setZoom(16);        }); // Масштабируем карту на область видимости геообъекта.    }</script>